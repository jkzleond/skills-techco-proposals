# ASCII 图转换技巧

本文档说明 AI Agent 如何理解 ASCII 图结构并转换为精美代码。

**⚠️ 重要：先阅读 output-specs.md**

在开始转换前，请确保已阅读 `references/output-specs.md`，了解：
- 各类型图形的输出格式（SVG vs HTML）
- 主题色系的使用
- 基本的代码结构要求

## 核心原则

1. **智能理解，不要机械转换**：识别图形结构，不是字符替换
2. **用矢量元素重绘**：使用 `<rect>`、`<line>`、`<text>` 等
3. **保留原始信息**：不丢失任何文本和层级关系
4. **美观优先**：使用现代设计风格（圆角、渐变、阴影）
5. **响应式布局**：确保支持自适应缩放

## 各类型识别技巧

### architecture - 系统架构图

**识别特征：**
- 嵌套方框（`┌┐└┘│─`）
- 层级关系（外框包含内框）
- 连接箭头（`→↓←↑`）
- 分隔线（`│─`）

**理解策略：**
1. 识别最外层方框 → 作为容器背景
2. 识别内层方框 → 作为子系统/模块
3. 识别箭头方向 → 确定数据/调用流向
4. 识别分隔符 → 确定边界和分组

**布局计算：**
```
示例：
┌─────────────────┐     ┌──────────┐
│   系统 A        │ ──→ │   系统 B  │
│  ┌──────┐       │     └──────────┘
│  │ 模块1 │       │
│  └──────┘       │
└─────────────────┘

转换为：
- 系统 A: rect(0, 0, 200, 120)
- 模块1: rect(20, 40, 160, 60) 嵌套在系统A内
- 系统 B: rect(220, 20, 120, 80)
- 箭头: line(200, 60) → (220, 60)
```

### flowchart - 流程图

**识别特征：**
- 水平/垂直排列的方框
- 箭头连接（`→`）
- 分支/合并（`↓` 或 `├─┤`）
- 循环/回退（`↑` 或 `←`）

**理解策略：**
1. 识别步骤框 → 作为流程节点
2. 识别箭头方向 → 确定流程走向
3. 识别分支点 → 使用菱形（如果存在判断）
4. 识别并行/合并 → 确定布局结构

**布局计算：**
```
水平流程：
┌────┐  →  ┌────┐  →  ┌────┐
│开始│      │处理│      │结束│
└────┘      └────┘      └────┘

转换为：
- 开始: rect(20, 20, 100, 50)
- 处理: rect(160, 20, 100, 50)
- 结束: rect(300, 20, 100, 50)
- 箭头: line(120, 45) → (160, 45) → (300, 45)
```

### ui - UI界面图

**识别特征：**
- 窗口/对话框（`┌─┐│└┘`）
- 按钮（`[按钮]` 或 `[  按钮  ]`）
- 输入框（`[__________]` 或 `┌────────┐`）
- 文本标签
- 分隔符（`│`）

**理解策略：**
1. 识别容器 → 作为卡片/面板
2. 识别按钮 → 作为 `<button>` 元素
3. 识别输入框 → 作为 `<input>` 元素
4. 识别层级 → 使用嵌套 div 结构
5. 识别布局 → 使用 flexbox 或 grid

**布局计算：**
```
┌──────────────────────┐
│   标题栏              │
│                       │
│  [按钮1]  [按钮2]     │
└──────────────────────┘

转换为 HTML：
- 容器: div(flex, column, gap: 12px)
- 标题: div(margin-bottom: 20px)
- 按钮组: div(flex, gap: 12px)
```

### timeline - 时间线图

**识别特征：**
- 时间轴（`──` 或 `│`）
- 时间节点（`●` 或 `┬`）
- 阶段标签
- 进度条

**理解策略：**
1. 识别时间轴方向（水平或垂直）
2. 识别时间节点 → 作为里程碑
3. 识别阶段跨度 → 绘制连接线
4. 识别标注 → 添加文本说明

**布局计算：**
```
Week 1    Week 2    Week 3
  │         │         │
  开始      设计      开发

转换为：
- 时间轴: line(50, 50) → (350, 50)
- 节点1: circle(50, 50) + text("开始")
- 节点2: circle(200, 50) + text("设计")
- 节点3: circle(350, 50) + text("开发")
```

### diagram - 通用图

**识别特征：**
- 混合元素
- 不符合上述任何类型
- 自定义结构

**理解策略：**
1. 识别主要元素（方框、箭头、文本）
2. 判断最相似的类型
3. 灵活处理，保留结构信息
4. 优先考虑可读性

## 转换技巧

### 技巧1：处理嵌套结构

**问题：** ASCII 中的嵌套关系容易丢失

**解决：**
```python
# 识别嵌套层级
层级1: 外框 (x=0, y=0, w=300, h=200)
层级2: 内框 (x=20, y=40, w=260, h=80)
层级3: 元素 (x=40, y=60, w=100, h=40)
```

### 技巧2：处理箭头方向

```python
# ASCII 符号 → SVG 方向
→ : 水平向右 (x1 < x2, y1 == y2)
← : 水平向左 (x1 > x2, y1 == y2)
↓ : 垂直向下 (x1 == x2, y1 < y2)
↑ : 垂直向上 (x1 == x2, y1 > y2)
```

### 技巧3：处理长文本

**问题：** SVG 文本不会自动换行

**解决：**
```xml
<!-- 错误：文本会超出 -->
<text x="80" y="50">这是一段非常长的文本内容...</text>

<!-- 正确：使用 tspan 换行 -->
<text x="80" y="50">
  <tspan x="80" dy="0">这是一段非常长的</tspan>
  <tspan x="80" dy="20">文本内容...</tspan>
</text>
```

### 技巧4：估算尺寸

**问题：** ASCII 字符是等宽的，SVG 不是

**解决：**
```python
# 经验公式
字符宽度 ≈ 8-10 像素
字符高度 ≈ 16-20 像素

方框宽度 = 字符数 * 10
方框高度 = 行数 * 20 + 20 (padding)
```

### 技巧5：保持对齐

```python
# 居中对齐
text_x = rect_x + rect_width / 2
text-anchor = "middle"

# 左对齐
text_x = rect_x + padding
text-anchor = "start"

# 右对齐
text_x = rect_x + rect_width - padding
text-anchor = "end"
```

## 验证技巧

生成代码后检查：

### 结构检查
- [ ] 所有方框都转换为 `<rect>`
- [ ] 所有箭头都转换为 `<line>` + `marker`
- [ ] 所有文本都转换为 `<text>`
- [ ] 嵌套关系正确（外框包含内框）

### 对齐检查
- [ ] 文本居中对齐（在方框中间）
- [ ] 箭头连接正确（从一个框到另一个框）
- [ ] 间距合理（不要太挤或太松）

### 美观检查
- [ ] 使用圆角（`rx` 属性）
- [ ] 使用阴影（`filter`）
- [ ] 使用渐变（`linearGradient`）
- [ ] 颜色协调（主题色系）

## 常见错误

### ❌ 错误1：机械转换

```xml
<!-- 错误：只是把ASCII包在SVG里 -->
<svg>
  <pre>┌────────┐
│  标题  │
└────────┘</pre>
</svg>
```

### ❌ 错误2：忽略嵌套

```xml
<!-- 错误：外框和内框重叠，没有包含关系 -->
<rect x="20" y="20" width="120" height="60"/>  <!-- 外框 -->
<rect x="20" y="20" width="120" height="60"/>  <!-- 内框，位置相同！-->
```

### ❌ 错误3：箭头方向错误

```xml
<!-- 错误：ASCII中箭头向右，SVG中却向左 -->
<line x1="300" y1="50" x2="100" y2="50"/>  <!-- 方向反了 -->
```

### ✅ 正确示例

**架构图：**
```xml
<svg viewBox="0 0 400 200">
  <!-- 外框 -->
  <rect x="20" y="20" width="360" height="160" fill="#f0f3ff" stroke="#667eea" rx="8"/>

  <!-- 内框1 -->
  <rect x="40" y="50" width="150" height="80" fill="white" stroke="#667eea" rx="6"/>

  <!-- 内框2 -->
  <rect x="210" y="50" width="150" height="80" fill="white" stroke="#667eea" rx="6"/>

  <!-- 连接线 -->
  <line x1="190" y1="90" x2="210" y2="90" stroke="#764ba2" stroke-width="2" marker-end="url(#arrow)"/>
</svg>
```

**流程图：**
```xml
<svg viewBox="0 0 600 100">
  <!-- 步骤1 -->
  <rect x="20" y="20" width="120" height="60" fill="white" stroke="#1890ff" rx="8"/>
  <text x="80" y="55" text-anchor="middle">步骤1</text>

  <!-- 箭头 -->
  <line x1="140" y1="50" x2="260" y2="50" stroke="#096dd9" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- 步骤2 -->
  <rect x="260" y="20" width="120" height="60" fill="white" stroke="#1890ff" rx="8"/>
  <text x="320" y="55" text-anchor="middle">步骤2</text>
</svg>
```

**UI界面（HTML）：**
```html
<div style="background: linear-gradient(135deg, #1890ff 0%, #096dd9 100%);
            border-radius: 12px;
            padding: 24px;">
  <div style="color: white; font-size: 18px; margin-bottom: 12px;">标题</div>
  <div style="display: flex; gap: 12px;">
    <button style="flex: 1; padding: 10px; background: white; border: none; border-radius: 8px;">按钮1</button>
    <button style="flex: 1; padding: 10px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 8px;">按钮2</button>
  </div>
</div>
```

## 总结

转换 ASCII 图的关键：
1. **理解结构**：识别嵌套、层级、连接关系
2. **重新绘制**：用矢量元素表达，不是字符替换
3. **保持信息**：不丢失任何文本和结构
4. **美化设计**：使用现代样式（圆角、阴影、渐变）
5. **验证检查**：确保结构正确、对齐合理、美观协调
